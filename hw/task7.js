// –†–µ–∞–ª–∏–∑—É–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é eventEmitter, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –ø—Ä–æ—Å—Ç—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –ø–∞—Ç—Ç–µ—Ä–Ω–∞ "–ò–∑–¥–∞—Ç–µ–ª—å-–ü–æ–¥–ø–∏—Å—á–∏–∫" (Publisher-Subscriber). –§—É–Ω–∫—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –∏–º–µ—Ç—å –º–µ—Ç–æ–¥—ã subscribe, unsubscribe –∏ publish. –ü–æ–¥–ø–∏—Å—á–∏–∫–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ–ø–æ–≤–µ—â–µ–Ω—ã –æ –∫–∞–∂–¥–æ–º —Å–æ–±—ã—Ç–∏–∏, –∫–æ—Ç–æ—Ä–æ–µ –±—ã–ª–æ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ.

// –ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ –ø–∞—Ç—Ç–µ—Ä–Ω–µ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –Ω–∞–π—Ç–∏ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ (—É–º–µ—Ç—å –≥—É–≥–ª–∏—Ç—å —Ö–æ—Ä–æ—à–∏–π –Ω–∞–≤—ã–∫üòâ)
function eventEmitter() {
    const subscribers = {}; // –æ–±—ä–µ–∫—Ç –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ –Ω–∞ —Å–æ–±—ã—Ç–∏—è

    return {
        // –ú–µ—Ç–æ–¥ –ø–æ–¥–ø–∏—Å–∫–∏
        subscribe(event, callback) {
            if (!subscribers[event]) {
                subscribers[event] = []; // —Å–æ–∑–¥–∞–µ–º –º–∞—Å—Å–∏–≤ –¥–ª—è –Ω–æ–≤–æ–≥–æ —Å–æ–±—ã—Ç–∏—è
            }
            subscribers[event].push(callback); // –¥–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–ø–∏—Å—á–∏–∫–∞
            return () => this.unsubscribe(event, callback); // –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –æ—Ç–ø–∏—Å–∫–∏
        },

        // –ú–µ—Ç–æ–¥ –æ—Ç–ø–∏—Å–∫–∏
        unsubscribe(event, callback) {
            if (!subscribers[event]) return;
            subscribers[event] = subscribers[event].filter(cb => cb !== callback); // —É–¥–∞–ª—è–µ–º –ø–æ–¥–ø–∏—Å—á–∏–∫–∞
        },

        // –ú–µ—Ç–æ–¥ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ —Å–æ–±—ã—Ç–∏–π
        publish(event, data) {
            if (!subscribers[event]) return;
            subscribers[event].forEach(callback => callback(data)); // –æ–ø–æ–≤–µ—â–∞–µ–º –≤—Å–µ—Ö –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤
        }
    };
}

// –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
const emitter = eventEmitter();

const unsubscribe = emitter.subscribe('message', (data) => {
    console.log(`–ü–æ–¥–ø–∏—Å—á–∏–∫ 1 –ø–æ–ª—É—á–∏–ª: ${data}`);
});

emitter.subscribe('message', (data) => {
    console.log(`–ü–æ–¥–ø–∏—Å—á–∏–∫ 2 –ø–æ–ª—É—á–∏–ª: ${data}`);
});

emitter.publish('message', '–ü—Ä–∏–≤–µ—Ç, –º–∏—Ä!'); // –û–±–∞ –ø–æ–¥–ø–∏—Å—á–∏–∫–∞ –ø–æ–ª—É—á–∞—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ

unsubscribe(); // –û—Ç–ø–∏—Å—ã–≤–∞–µ–º –ø–µ—Ä–≤–æ–≥–æ –ø–æ–¥–ø–∏—Å—á–∏–∫–∞

emitter.publish('message', '–ü—Ä–∏–≤–µ—Ç —Å–Ω–æ–≤–∞!'); // –¢–æ–ª—å–∫–æ –≤—Ç–æ—Ä–æ–π –ø–æ–¥–ø–∏—Å—á–∏–∫ –ø–æ–ª—É—á–∏—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
